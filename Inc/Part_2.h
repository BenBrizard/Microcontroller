#ifndef PART2_H

#define PART2_H
#define LUT_SIZE 170
#define DMA_SIZE 2000
#define SAMPLE_FREQ 40000

#include <stdint.h>
#include "Part_3.h"
/* USER STRUCTURES - BEGIN*/
typedef struct Instruments {
    int A,D,S,R;
}instrument;

/* Définition des 4 ADSR de nos instruments */
instrument jeu = {.A=800 ,.D=2000, .S=5, .R=2000};
instrument piano = {.A=800 ,.D=15000, .S=5, .R=15000};
instrument  violon = {.A=8000 ,.D=2000, .S=28000, .R=2000};
instrument flute = {.A=2000 ,.D=40, .S=35390, .R=50};
instrument diapason = {.A=8000 ,.D=2000, .S=28000, .R=2000}; // À MODIFIER POUR ETRE PLUS FIDELE

const uint16_t PIANO_LUT[]={
1024,1020,1017,1014,1004,999,990,976,959,942,924,905,884,861,840,815,791,765,735,701,665,625,584,541,500,461,429,407,390,379,373,370,
	368,364,359,352,341,332,322,315,307,301,297,295,295,294,295,296,298,304,314,325,338,350,360,365,364,360,355,353,348,342,333,323,312,
	302,293,283,271,258,241,223,200,177,153,131,114,105,106,113,122,131,139,144,147,147,140,132,120,109,98,91,85,78,71,58,43,28,15,5,0,
	0,3,10,20,32,45,55,59,61,60,57,51,48,46,49,55,62,71,83,98,115,134,157,181,208,237,264,289,311,331,348,366,384,407,430,450,466,478,
	488,497,504,508,509,509,512,520,534,554,578,604,631,659,688,721,752,786,821,855,887,915,939,959,976,989,999,1006,1013,1019,1024
};

const uint16_t FLUTE_LUT[]={
708,704,700,697,696,684,680,669,655,652,639,623,610,598,585,568,555,540,531,530,526,526,535,548,568,593,621,643,680,726,767,810,
	854,892,923,947,975,1002,1018,1022,1024,1022,1017,1012,1007,993,974,957,941,928,915,894,875,859,839,818,799,780,755,731,715,693,
	670,645,620,600,584,562,536,511,493,463,421,393,368,334,301,258,214,178,143,107,75,48,30,10,0,7,24,52,92,144,197,259,327,392,456,
	519,580,635,683,735,777,812,854,887,920,942,956,978,989,990,997,987,971,957,943,920,889,856,817,777,743,699,654,615,577,538,500,
	465,439,413,390,372,354,349,346,344,343,342,352,357,362,373,390,407,421,433,450,468,489,514,537,551,563,583,604,618,636,648,657,
	671,676,683,696,697,700,702,704,708
};

const uint16_t VIOLON_LUT[]={
1024,1020,1008,989,962,930,893,852,810,766,724,679,636,591,548,504,466,432,404,381,362,344,327,309,294,280,270,262,256,248,238,224,
	207,189,165,142,117,94,70,51,33,20,8,2,0,7,21,41,65,89,111,131,148,163,178,192,208,222,239,258,278,302,324,349,369,390,407,423,440,
	457,475,494,513,533,553,572,593,609,622,630,633,633,629,624,616,605,591,576,557,541,524,506,489,470,449,427,403,384,367,358,350,
	350,346,344,339,330,321,308,293,277,256,232,210,186,169,152,143,138,141,145,151,156,160,164,170,180,194,213,237,266,297,334,374,
	419,464,510,554,593,624,647,663,676,687,701,714,727,738,747,755,762,768,777,786,799,813,829,844,860,874,890,907,924,943,961,977,
	995,1008,1019,1023,1024
};

const uint16_t SINE_LUT[]={ 
512,531,550,569,588,607,625,644,662,680,698,716,733,750,767,783,799,814,830,844,859,872,886,898,911,922,933,944,954,963,972,980,987,
	994,1000,1006,1010,1014,1018,1020,1022,1023,1024,1024,1023,1021,1019,1016,1012,1008,1003,997,991,984,976,968,959,949,939,928,917,
	905,892,879,866,852,837,822,807,791,775,758,741,724,707,689,671,653,635,616,597,578,560,541,522,502,483,464,446,427,408,389,371,
	353,335,317,300,283,266,249,233,217,202,187,172,158,145,132,119,107,96,85,75,65,56,48,40,33,27,21,16,12,8,5,3,1,0,0,1,2,4,6,10,
	14,18,24,30,37,44,52,61,70,80,91,102,113,126,138,152,165,180,194,210,225,241,257,274,291,308,326,344,362,380,399,417,436,455,
	474,493,512
};

/* USER STRUCTURES - END*/

const float pi=3.14159265359;
float signal_freq = 0.0f;
int nb_points_adsr = 0;
int iterateur_adsr=0;
float amplitude_modulator=0.0f; // Modulateur d'amplitude pour le ADSR
float phase=0.0f;
int instrument_id = 0;

uint32_t dac_buffer_ping[DMA_SIZE]={0};//double buffer for dma
uint32_t dac_buffer_pong[DMA_SIZE]={0};
uint32_t* to_write=dac_buffer_ping;
uint32_t* to_process=dac_buffer_pong;

/* Pointeur pour y accéder facilement 
* [0]: Diapason
* [1]: Piano
* [2]: Flute
* [3]: Violon
*/ 
instrument* instruments[]={&piano, &flute, &violon,&diapason, &jeu}; 
const uint16_t* LUT_TABLE[] = {PIANO_LUT, FLUTE_LUT, VIOLON_LUT, SINE_LUT, PIANO_LUT};
/* USER FUNCTIONS - BEGIN*/
void play_note (float chosen_note, int chosen_instrument);
void update_tab(uint32_t * tab, setting *chosen_setting);
/* USER FUNCTIONS - END*/

#endif
